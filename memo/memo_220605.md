# Starting a Django project

準備

1. GitHub に新しいプロジェクトを作成する django_example
2. 仮想環境を作成する。python 3.8 をベースとする ~/work/venvs/py38mlDjango
3. リポジトリをクローンする ~/work/github_HideKobayashi/django_example
4. VSCode で上記ディレクトリを開く
5. VSCode のオプション「Python インタープリタを選択」で上記仮想環境 py38mlDjango を選ぶ

仮想環境の構築

事前に miniconda などがインストールされているものとする。

```
$ conda activate py38ml
$ python -m venv ~/work/venvs/py38mlDjango
$ source ~/work/venvs/py38mlDjango
$ python -m pip install --upgrade pip
```


## Django をインストールする

書籍では、Django 3.2 で説明されているが、ここではあえて、最新バージョンを使う。

```
$ pip install django
```

今回インストールされた Django は 4.0.5

```
$ python -m django --version
4.0.5
```

## Django プロジェクトを作製する

Django をインストールした後に改めてターミナルを起動し直し、仮想環境を有効化する。
tree コマンドは Windows の場合は PowerShell に含まれる。
macOS の場合は `brew install tree` でインストールできる。

```
$ cd django_example
$ django-admin startproject djangosnippets
$ tree djangosnippets 
djangosnippets
├── djangosnippets
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py

1 directory, 6 files
```

## Django プロジェクトの動作確認

```
$ cd django_example/djangosnippetes
$ python manage.py runserver
```

ブラウザで `http://localhost:8000/` を開いて、ロケットのアニメーションが動作していることを確認する。

ブランチを作製してアップロード、pull request、マージを行う。
ブランチ名：snippets_initial_00

## 言語設定とタイムゾーンの変更

main ブランチを　pull して、そこから新しいブランチを作製する。

ブランチ名：snippets_phase01_customize

プロジェクトの設定を変更して再度確認する。

`djangosnippets/settings.py` の中の `LANGUAGE_CODE` をjaに書き換える

```python
LANGUAGE_CODE='ja'  #デフォルト値:'enus'
TIME_ZONE='Asia/Tokyo'  #デフォルト値:'UTC'
```

ブラウザで `http://localhost:8000/` を開いて、表示が日本語になっていることを確認する。


## データベースの設定

`djangosnippets/settings.py` の中の `BASE_DIR`, `DATABASES` の設定を確認する。

デフォルトでは sqlite3 を使うように設定されている。

```python
...

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

...

# Database
# https://docs.djangoproject.com/en/4.0/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

```

データベースにテーブルの作製を行う。

```
$ python manage.py mingrate
```

sqlite3 ファイルに作られたテーブルを確認する。

```
$ sqlite3 db.sqlite3
sqlite> .tables
auth_group                  auth_user_user_permissions
auth_group_permissions      django_admin_log          
auth_permission             django_content_type       
auth_user                   django_migrations         
auth_user_groups            django_session            
sqlite> .exit
```



